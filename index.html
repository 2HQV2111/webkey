<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>T·∫°o Key m·ªõi</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRlIh-vPXOhDjK13KWtmWqYAswksBNuvOOUzA&s') no-repeat center center fixed;
      background-size: cover;
      background-color: rgba(0, 0, 0, 0.4);
      color: white;
      text-shadow: 1px 1px 2px black;
    }
    input, button, select {
      padding: 10px;
      margin: 8px 0;
      width: 100%;
      border: none;
      border-radius: 5px;
    }
    input, select {
      background: rgba(255,255,255,0.85);
      color: #000;
      box-sizing: border-box;
    }
    button {
      background: linear-gradient(135deg, #ff4e50, #f9d423);
      color: #fff;
      font-weight: bold;
      font-size: 16px;
      text-transform: uppercase;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
      transition: 0.3s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #f9d423, #ff4e50);
      transform: scale(1.08);
    }
    .log {
      margin-top: 10px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 5px;
      white-space: pre-wrap;
      font-family: monospace;
      max-height: 400px;
      overflow-y: auto;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    .hidden {
      display: none;
    }
    #copyBtn {
      display: none;
      max-width: 300px;
      margin: 10px auto;
      background-color: #007bff;
    }
  </style>
</head>
<body>
  <div id="loginSection" style="max-width: 400px; margin: auto;">
    <h2 style="text-align: center;">üîê ƒêƒÉng nh·∫≠p</h2>
    <label for="username">T√™n ƒëƒÉng nh·∫≠p:</label>
    <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p">
    <label for="password">M·∫≠t kh·∫©u:</label>
    <div style="position: relative; width: 100%;">
      <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" style="width: 100%; padding-right: 48px; box-sizing: border-box;">
      <span onclick="togglePassword()" style="position: absolute; right: 14px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 18px; color: #444;">üëÅÔ∏è</span>
    </div>
    <div style="display: flex; align-items: center; margin: 10px 0;">
      <input type="checkbox" id="rememberMe" style="margin-right: 8px; width: auto;">
      <label for="rememberMe" style="margin: 0;">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
    </div>
    <button onclick="login()">ƒêƒÇNG NH·∫¨P</button>
    <div id="loginLog" class="log"></div>
  </div>

  <div id="keySection" class="hidden">
    <h2>T·∫°o Key m·ªõi</h2>
    <label>Nh·∫≠p t√™n mi·ªÅn:</label>
    <input type="text" id="prefix" placeholder="Nh·∫≠p t√™n mi·ªÅn">
    <label>S·ªë l∆∞·ª£ng key mu·ªën t·∫°o:</label>
    <input type="number" id="keyCount" placeholder="S·ªë l∆∞·ª£ng key mu·ªën t·∫°o" min="1">
    <label>Th·ªùi h·∫°n:</label>
    <div style="display: flex; gap: 10px;">
      <input type="number" id="days" placeholder="Ng√†y" style="flex: 1;">
      <input type="number" id="hours" placeholder="Gi·ªù" style="flex: 1;">
      <input type="number" id="minutes" placeholder="Ph√∫t" style="flex: 1;">
      <input type="number" id="seconds" placeholder="Gi√¢y" style="flex: 1;">
    </div>
    <label>S·ªë thi·∫øt b·ªã cho ph√©p:</label>
    <input type="number" id="maxDevices" placeholder="S·ªë thi·∫øt b·ªã cho ph√©p">
    <button onclick="createKeys()" style="max-width: 300px; margin: 10px auto; display: block;">üöÄ T·∫°o Key Ngay</button>
    <div class="log" id="log"></div>
    <button id="copyBtn" onclick="copyToClipboard()">üìã Sao ch√©p k·∫øt qu·∫£</button>

    <button onclick="showAllKeys()" style="max-width: 300px; margin: 10px auto; display: block; background: seagreen;">üìã Xem danh s√°ch key</button>
    <div class="log" id="allKeysLog"></div>

    <hr style="margin: 20px 0;">
    <h3>Xo√° Key</h3>
    <label>Nh·∫≠p t√™n key mu·ªën xo√°:</label>
    <input type="text" id="deleteKeyName" placeholder="V√≠ d·ª•: mydomain_A1B2C3">
    <button onclick="deleteKey()" style="max-width: 200px; margin: 10px auto; display: block; background: crimson;">‚ùå X√≥a Key</button>
    <div class="log" id="deleteLog"></div>
  </div>

  <script>
    function togglePassword() {
      const pwInput = document.getElementById("password");
      pwInput.type = pwInput.type === "password" ? "text" : "password";
    }

    function formatHSD(d, h, m, s) {
      if (d > 0) return `${d} ng√†y`;
      if (h > 0) return `${h} gi·ªù`;
      if (m > 0) return `${m} ph√∫t`;
      if (s > 0) return `${s} gi√¢y`;
      return "V√¥ th·ªùi h·∫°n";
    }

    function copyToClipboard() {
      const text = document.getElementById("log").innerText;
      navigator.clipboard.writeText(text).then(() => alert("üìã ƒê√£ sao ch√©p k·∫øt qu·∫£!"));
    }

    window.onload = function () {
      const savedUser = localStorage.getItem("saved_username");
      const savedPass = localStorage.getItem("saved_password");
      if (savedUser && savedPass) {
        document.getElementById("username").value = savedUser;
        document.getElementById("password").value = savedPass;
        document.getElementById("rememberMe").checked = true;
      }
    };

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      const remember = document.getElementById("rememberMe").checked;
      const loginLog = document.getElementById("loginLog");
      const validUser = USERS.find(u => u.username === user && u.password === pass);
      if (validUser) {
        if (remember) {
          localStorage.setItem("saved_username", user);
          localStorage.setItem("saved_password", pass);
        } else {
          localStorage.removeItem("saved_username");
          localStorage.removeItem("saved_password");
        }
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("keySection").classList.remove("hidden");
      } else {
        loginLog.innerText = "‚ùå Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!";
      }
    }

    function generateRandomString(length) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    async function createKeys() {
      const prefix = document.getElementById('prefix').value.trim();
      const keyCount = parseInt(document.getElementById('keyCount').value);
      const maxDevices = parseInt(document.getElementById('maxDevices').value);
      const log = document.getElementById('log');
      const copyBtn = document.getElementById('copyBtn');
      const days = parseInt(document.getElementById('days').value) || 0;
      const hours = parseInt(document.getElementById('hours').value) || 0;
      const minutes = parseInt(document.getElementById('minutes').value) || 0;
      const seconds = parseInt(document.getElementById('seconds').value) || 0;
      const totalSeconds = (days * 86400) + (hours * 3600) + (minutes * 60) + seconds;
      const hsdText = formatHSD(days, hours, minutes, seconds);

        if (!prefix) return log.innerText = '‚ö†Ô∏è B·∫°n ch∆∞a nh·∫≠p t√™n mi·ªÅn.';
	if (isNaN(keyCount) || keyCount <= 0) return log.innerText = '‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë key mu·ªën t·∫°o.';
	if (totalSeconds <= 0) return log.innerText = '‚ö†Ô∏è Vui l√≤ng nh·∫≠p th·ªùi gian h·ª£p l·ªá.';
	if (isNaN(maxDevices) || maxDevices <= 0) return log.innerText = '‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë thi·∫øt b·ªã t·ªëi ƒëa.';



      let resultLog = '';
      for (let i = 0; i < keyCount; i++) {
        let fullKey = '', attempts = 0;
        while (attempts < 10) {
          fullKey = `${prefix}_${generateRandomString(10)}`;
          const check = await fetch(`https://hqvkey-default-rtdb.firebaseio.com/valid_keys/${fullKey}.json`);
          if (await check.json() === null) break;
          attempts++;
        }

        if (attempts === 10) {
          resultLog += `‚ùå Kh√¥ng t·∫°o ƒë∆∞·ª£c key sau 10 l·∫ßn: ${prefix}_xxxxxx\n`;
          continue;
        }

        const url = `https://hqvkey-default-rtdb.firebaseio.com/valid_keys/${fullKey}.json`;
        const body = {
          expires_after: totalSeconds,
          activated_at: 0,
          device_id: "",
          max_devices: maxDevices
        };

        try {
          const res = await fetch(url, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          });
          if (res.ok) {
            if (keyCount === 1) {
              resultLog = `=====KEY NGO KHONG=====\nKEY: ${fullKey}\nHSD: ${hsdText}\nS·ªë TB: ${maxDevices}\n=======================`;
            } else {
              resultLog += `‚úÖ ${fullKey}\n`;
            }
          } else {
            resultLog += `‚ùå L·ªói t·∫°o key ${fullKey}.\n`;
          }
        } catch (err) {
          resultLog += `‚ùå L·ªói m·∫°ng khi t·∫°o key ${fullKey}: ${err.message}\n`;
        }
      }

      log.innerText = resultLog.trim();
      copyBtn.style.display = "block";
    }

    async function deleteKey() {
      const keyName = document.getElementById("deleteKeyName").value.trim();
      const deleteLog = document.getElementById("deleteLog");

      if (!keyName) {
        deleteLog.innerText = "‚ö†Ô∏è B·∫°n ch∆∞a nh·∫≠p t√™n key.";
        return;
      }

      const url = `https://hqvkey-default-rtdb.firebaseio.com/valid_keys/${keyName}.json`;

      try {
        const res = await fetch(url, { method: "DELETE" });
        if (res.ok) {
          deleteLog.innerText = `‚úÖ ƒê√£ xo√° key: ${keyName}`;
        } else {
          deleteLog.innerText = `‚ùå Kh√¥ng xo√° ƒë∆∞·ª£c key ${keyName}. M√£ l·ªói: ${res.status}`;
        }
      } catch (err) {
        deleteLog.innerText = `‚ùå L·ªói khi xo√° key: ${err.message}`;
      }
    }

   
async function showAllKeys() {
  const allKeysLog = document.getElementById("allKeysLog");
  allKeysLog.innerText = "‚è≥ ƒêang t·∫£i...";
  try {
    const res = await fetch("https://hqvkey-default-rtdb.firebaseio.com/valid_keys.json");
    const allKeys = await res.json();
    if (!allKeys) {
      allKeysLog.innerText = "‚ö†Ô∏è Kh√¥ng c√≥ key n√†o trong h·ªá th·ªëng.";
      return;
    }

    const now = Math.floor(Date.now() / 1000);
    let text = "";
    for (const [key, value] of Object.entries(allKeys)) {
      const act = value.activated_at || 0;
      const exp = value.expires_after || 0;
      let hsd = "", status = "";

      if (act === 0) {
        let remain = exp;
        const d = Math.floor(remain / 86400);
        const h = Math.floor((remain % 86400) / 3600);
        const m = Math.floor((remain % 3600) / 60);
        const s = remain % 60;
        hsd = `${d}d ${h}h ${m}m ${s}s`;
        status = "‚ùå";
      } else {
        const remain = (act + exp) - now;
        if (remain <= 0) {
          // ‚úÖ T·ª± ƒë·ªông x√≥a key h·∫øt h·∫°n
          await fetch(`https://hqvkey-default-rtdb.firebaseio.com/valid_keys/${key}.json`, {
            method: "DELETE"
          });
          continue; // B·ªè qua key ƒë√£ x√≥a
        } else {
          const d = Math.floor(remain / 86400);
          const h = Math.floor((remain % 86400) / 3600);
          const m = Math.floor((remain % 3600) / 60);
          const s = remain % 60;
          hsd = `${d}d ${h}h ${m}m ${s}s`;
          status = "‚úÖ";
        }
      }

      text += `üîë ${key} | HSD: ${hsd} | ${status}\n`;
    }

    allKeysLog.innerText = text.trim();
  } catch (err) {
    allKeysLog.innerText = `‚ùå L·ªói khi t·∫£i key: ${err.message}`;
  }
}

</script>



  <!-- Load danh s√°ch t√†i kho·∫£n -->
  <script src="users.js"></script>
</body>
</html>
